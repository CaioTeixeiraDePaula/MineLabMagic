name: Minecraft Server

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    # - name: Update apt
    #   run: |
    #     sudo apt update
    #     sudo apt upgrade
    
    - name: Set up JDK
      uses: actions/setup-java@v2
      with: 
        distribution: 'adopt'
        java-version: '17' 
    
    - name: Download and setup Minecraft server
      run: |
        wget https://piston-data.mojang.com/v1/objects/8dd1a28015f51b1803213892b50b7b4fc76e594d/server.jar
        java -Xmx1024M -Xms1024M -jar server.jar nogui
      
    - name: Set Eula and Prorpieties
      run: |
        echo eula=true > eula.txt
        echo |
          allow-flight=false
          allow-nether=true
          broadcast-console-to-ops=true
          broadcast-rcon-to-ops=true
          difficulty=easy
          enable-command-block=true
          enable-jmx-monitoring=false
          enable-query=false
          enable-rcon=false
          enable-status=true
          enforce-secure-profile=true
          enforce-whitelist=false
          entity-broadcast-range-percentage=100
          force-gamemode=false
          function-permission-level=2
          gamemode=creative
          generate-structures=true
          generator-settings={}
          hardcore=false
          hide-online-players=false
          initial-disabled-packs=
          initial-enabled-packs=vanilla
          level-name=banana
          level-seed=
          level-type=minecraft\:normal
          log-ips=true
          max-chained-neighbor-updates=1000000
          max-players=20
          max-tick-time=60000
          max-world-size=29999984
          motd=Git Server
          network-compression-threshold=256
          online-mode=true
          op-permission-level=4
          player-idle-timeout=0
          prevent-proxy-connections=false
          pvp=true
          query.port=25565
          rate-limit=0
          rcon.password=
          rcon.port=25575
          require-resource-pack=false
          resource-pack=
          resource-pack-id=
          resource-pack-prompt=
          resource-pack-sha1=
          server-ip=26.175.173.254
          server-port=25565
          simulation-distance=10
          spawn-animals=true
          spawn-monsters=true
          spawn-npcs=true
          spawn-protection=16
          sync-chunk-writes=true
          text-filtering-config=
          use-native-transport=true
          view-distance=10
          white-list=false > server.properties

    - name: Start Server
      run:  |
        java -Xmx4g -Xms1024M -jar server.jar nogui
